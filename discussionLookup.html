<!DOCTYPE html>
<!-- HTML5 Hello world by kirupa - http://www.kirupa.com/html5/getting_your_feet_wet_html5_pg1.htm -->
<html lang="en-us">

<head>
<meta charset="utf-8">
<title>Hello...</title>
</style>
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
  <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
</head>

<!-- START HTML -->
<body>
<div id="mainContent" class="container-fluid">
	<div id="mainparent" class="col-md-offset-1 col-md-10">
        <div class="col-md-offset-4 col-md-4"><br><br>
      <input type="text" id="searchBox" class="input-sm" value="">
      <button id="clickButton" class="btn btn-warning">click me</button>
    </div>
    <h2><p id="helloText" class="col-md-offset-4 col-md-4">?</p></h2>
    <div id="displayer" class="col-md-offset-1 col-md-10">
		<p>Reddit Search </p>
	</div>
	</div>
</div>
<!-- END HTML -->



<!-- SCRIPT SECTION -->
<script> 
var myButton = document.getElementById("clickButton");
var myText = document.getElementById("helloText");
myButton.addEventListener('click', doSomething, false)


function doSomething() {
	myText.textContent = "Searching...";
  var searchTerm = document.getElementById("searchBox").value;
  console.log(searchTerm);
	requestReddit(searchTerm);
}

function requestReddit(statement) {
    
  var xmlhttp;
  if (window.XMLHttpRequest) {
    xmlhttp = new XMLHttpRequest();
  } else {
    xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
  }
    
  xmlhttp.onreadystatechange = function () {
    //connection is good and status is okay;
    if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
      var response = xmlhttp.responseText;
      localStorage.setItem('redditInfo', response)
      loadRedditList();
        } // readystate
  } // xml
    
  var url = "https://www.reddit.com/r/cs361projectb/search.json?q=" + statement + "&sort=top&restrict_sr=on&t=year";
  xmlhttp.open("GET",url, true);
  xmlhttp.send(); 
}
// need reddit api info
function loadRedditList() {
	var redditObj = JSON.parse(localStorage.getItem('redditInfo'))
  var outputList = document.getElementById('displayer');
  // remove any children 
    
  while (outputList.firstChild) {
    outputList.removeChild(outputList.firstChild);
  }
  var obj = redditObj.data.children; 
	myText.textContent = obj.length + " Results Found!";
  
  var accordionPanel = document.createElement('div');
  accordionPanel.setAttribute('class', "panel-group");
  accordionPanel.setAttribute('id', "accordion");
  
  for (i = 0; i < obj.length; i++) {
    //console.log(obj[i].data.url);
    var uList = document.createElement('list-group');
    uList.setAttribute('id', 'currentList');
    
    //var uPanel = document.createElement('div');
    //uPanel.setAttribute('class', "panel-group");
    //uPanel.setAttribute('id', "accordion");
    
    var redditPanelOuter = document.createElement('div');
    redditPanelOuter.setAttribute('class', "panel panel-default");
    redditPanelOuter.setAttribute('id', 'panel' + i);    
     
    var redditPanelHeading = document.createElement('div');
    redditPanelHeading.setAttribute('class', "panel-heading");
    redditPanelHeading.setAttribute('id', "accordion");
    
    var redditPanelContentOuter = document.createElement('div');
    redditPanelContentOuter.setAttribute('class', "panel-collapse collaps in")
    redditPanelContentOuter.setAttribute('id', "collapse' + i + '");

    var redditPanelContentInner = document.createElement('div');
    redditPanelContentInner.setAttribute('class', "panel-body");
    
    var redditURL = document.createElement('a'); 
    var redditTitle = document.createElement('p');   
    // stores parent posting content 
    var redditContent = document.createElement('div');

    
    
     // titleToken[0] is the api person's lookup code.
    // titleToken[1] is category
    // titleToke[2] will be thread title   
    var titleRaw = obj[i].data.title;
    var titleToken = titleRaw.split("] ");
    
    console.log(titleToken);
    // https://jsfiddle.net/Wc4xt/1052/
    // titleToken[2]
    redditTitle.innerHTML = '<a data-toggle="collapse" data-target="#collapse' + i + '" href=#collapse' + i + '>"' 
      + titleToken[2] 
      + '<span class="badge">' + obj[i].data.num_comments + ' comments</span>'  
      + '</a>';
    
    redditContent.innerHTML = obj[i].data.selftext;
    
    redditPanelContentInner.appendChild(redditContent);
    redditPanelContentOuter.appendChild(redditPanelContentInner);
    redditPanelHeading.appendChild(redditTitle);
    
    redditPanelOuter.appendChild(redditPanelHeading);
    redditPanelOuter.appendChild(redditPanelContentOuter);
    
    //redditTitle.innerHTML = '<h2>' + titleToken[2] + '</h2>';
    
    /*
    redditURL.innerHTML = '<a href="' 
      + obj[i].data.url + '" class="list-group-item">' + obj[i].data.title 
      + '<span class="badge">' + obj[i].data.num_comments + ' comments</span>' 
      + '<p class="collapse">' + obj[i].selftext + '</p>'
      + '<p><a class="btn" href="#"> collapse </a></p>'
      + '</a>';
    // redditTitle.textContent = obj[i].data.title;
     uList.appendChild(redditTitle);
    */
    
		//uList.appendChild(redditURL);
    accordionPanel.appendChild(redditPanelOuter);
	}
  outputList.appendChild(accordionPanel);
}


</script>
</body>
</html>
