<!DOCTYPE html>
<!-- HTML5 Hello world by kirupa - http://www.kirupa.com/html5/getting_your_feet_wet_html5_pg1.htm -->
<html lang="en-us">

<head>
<meta charset="utf-8">
<title>Hello...</title>
</style>
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
  <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
</head>

<!-- START HTML -->
<body>
<div id="mainContent" class="container-fluid">
	<div id="mainparent" class="col-md-offset-1 col-md-10">
        <div class="col-md-offset-4 col-md-4"><br><br>
      <input type="text" id="searchBox" class="input-sm" value="">
      <button id="clickButton" class="btn btn-warning">click me</button>
    </div>
    <h2><p id="helloText" class="col-md-offset-4 col-md-4">?</p></h2>
    <div id="displayer" class="col-md-offset-1 col-md-10">
		<p>Reddit Search </p>
	</div>
	</div>
</div>
<!-- END HTML -->



<!-- SCRIPT SECTION -->
<script> 
var myButton = document.getElementById("clickButton");
var myText = document.getElementById("helloText");
myButton.addEventListener('click', doSomething, false)


function doSomething() {
	myText.textContent = "Searching...";
  var searchTerm = document.getElementById("searchBox").value;
  console.log(searchTerm);
	requestReddit(searchTerm);
}

function requestReddit(statement) {
    
  var xmlhttp;
  if (window.XMLHttpRequest) {
    xmlhttp = new XMLHttpRequest();
  } else {
    xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
  }
    
  xmlhttp.onreadystatechange = function () {
    //connection is good and status is okay;
    if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
      var response = xmlhttp.responseText;
      localStorage.setItem('redditInfo', response)
      loadRedditList();
        } // readystate
  } // xml
    
  var url = "https://www.reddit.com/r/cs361projectb/search.json?q=" + statement + "&sort=top&restrict_sr=on&t=year";
  xmlhttp.open("GET",url, true);
  xmlhttp.send(); 
}
// need reddit api info
function loadRedditList() {
	var redditObj = JSON.parse(localStorage.getItem('redditInfo'))
  var outputList = document.getElementById('displayer');
  // remove any children 
    
  while (outputList.firstChild) {
    outputList.removeChild(outputList.firstChild);
  }
  var obj = redditObj.data.children; 
	myText.textContent = obj.length + " Results Found!";
  
  var accordionPanel = document.createElement('div');
  accordionPanel.setAttribute('class', "panel-group");
  accordionPanel.setAttribute('id', "accordion");
  
  for (i = 0; i < obj.length; i++) {
    var collapseHeader = "#collapse" + i;
    var collapseID = "collapse" + i;
    //console.log(obj[i].data.url);
    
    var redditPanelOuter = document.createElement('div');
    redditPanelOuter.setAttribute('class', "panel panel-default"); 
     
    var redditPanelHeading = document.createElement('div');
    redditPanelHeading.setAttribute('class', "panel-heading");
    
    var redditPanelTitle = document.createElement('h4');
    redditPanelTitle.setAttribute('class', "panel-title");
    
    var redditPanelContentOuter = document.createElement('div');
    redditPanelContentOuter.setAttribute('class', "panel-collapse collapse")
    redditPanelContentOuter.setAttribute('id', collapseID);

    var redditPanelContentInner = document.createElement('div');
    redditPanelContentInner.setAttribute('class', "panel-body");
    
   
    // stores parent posting content 

    // titleToke[2] will be thread title   
    var titleRaw = obj[i].data.title;
    var titleToken = titleRaw.split("] ");
    
    console.log(titleToken);
    // titleToken[2]
    // redditTitle
    redditPanelTitle.innerHTML = '<a data-toggle="collapse" data-parent="#accordion" href=' + collapseHeader + '>' + titleToken[2] + '</a>';
      //+ '<span class="badge">' + obj[i].data.num_comments + ' comments</span>'  
      //+ '</a>';

    var commentCount = document.createElement('span');
    commentCount.setAttribute('class', "badge pull-md-right");
    commentCount.innerHTML = obj[i].data.num_comments + ' comments';
    
    redditPanelHeading.appendChild(redditPanelTitle);
    redditPanelHeading.appendChild(commentCount);
    redditPanelOuter.appendChild(redditPanelHeading);    
    
    
    // Post + hyperlink
    
        
    redditPanelContentInner.innerHTML = '<a href=' + obj[i].data.url + '>' + obj[i].data.selftext + '</a>';

    redditPanelContentOuter.appendChild(redditPanelContentInner);
    redditPanelOuter.appendChild(redditPanelContentOuter);
    accordionPanel.appendChild(redditPanelOuter);
	}
  outputList.appendChild(accordionPanel);
}


</script>
</body>
</html>
